var grainType=2;var timeType=1;var currentPage=1;var name;var userId=DES3.decrypt(localStorage.getItem("ud"));var ownerId=DES3.decrypt(localStorage.getItem("ownerId"));var depotRes=Restful.post("bsinventorydepot/getDepots",{userId:userId});if(depotRes&&depotRes.length!=0){var html="";for(var i=0,len=depotRes.length;i<len;i++){html+='<li data-depot="'+depotRes[i].id+'">'+depotRes[i].name+"</li>"}$(".select").html("").append(html);$(".top h2").html($(".select li").eq(0).text()+'--未完成入库单 <img src="accountData/img/u40.png"/>');$(".select li").eq(0).addClass("depotChange")}else{$(".select").html("").append('<li data-depot="0">默认库</li>');$(".top h2").html($(".select li").eq(0).text()+'--未完成入库单 <img src="accountData/img/u40.png"/>');$(".select li").eq(0).addClass("depotChange")}$(".top").click(function(){$(".select").slideToggle()});$(".select").on("click","li",function(){var a=$(this).text();$(this).addClass("depotChange").siblings().removeClass("depotChange");$(".top h2").html(a+'--未完成入库单 <img src="accountData/img/u40.png"/>');getData();shouMoreText()});getData();shouMoreText();$("#search").on("click",function(){getData()});var driverArray=[];var driver=Restful.post("bsinventorystaff/list",{userId:ownerId,staffType:3,pageSize:1000});if(driver){if(driver.success){var driverArr=driver.dataList;driverArray.push({id:0,text:"请选择",phone:""});$.each(driverArr,function(a,b){driverArray.push({id:b.staffId,text:b.trueName,phone:b.phone})})}else{driverArray.push({id:0,text:"无",phone:""})}}$("#driver").select2({data:driverArray,templateResult:formatState});function formatState(b){if(!b.id){return b.text}var a="";if(b.text!="请选择"){a=$('<span style="display: inline-block;height: 2rem;">姓名: '+b.text+"</br><span>手机号:"+b.phone+"</span></span>")}else{a=$('<span style="display: inline-block;">'+b.text+"</span>")}return a}function getData(){var f={};f.grainType="";f.recordNumber="";f.searchType=1;f.currentPage=currentPage;f.userId=ownerId;f.operateUserId=userId;f.depotId=$(".depotChange").attr("data-depot");f.recordType=1;f.pageSize=10;f.strTime="";f.endTime="";f.licensePlate="";f.staffId="";f.driverId=$("#driver").val();var c=Restful.post("bsInventoryTemporary/search",f);if(c.success){var d=c.dataList;var e=$("#inStorage-list").html();var a=Template7.compile(e);var b=a({inStorage:d});$("#list").html(b);$(".more-text").removeClass("hiden")}else{$(".more").css("display","none");$("#list").html('<div style="width: 100%"><div style="width: 100%;height: 5rem;background: url(../img/nodata.png) center no-repeat;background-size: 50% 5rem;margin-top: 3rem;"></div><div style="text-align: center;margin-top: 1rem"><span style="color: #929292;font-size: 0.9rem;">暂无此类数据~</span></div></div>')}}function loadMore(){moreCtrl();currentPage+=1;getDataAsync()}function moreCtrl(){var b=$(".more-text");var a=$(".spinner");if(b.hasClass("hiden")){b.removeClass("hiden");a.addClass("hiden");excu=true}else{b.addClass("hiden");a.removeClass("hiden");excu=true}}function getDataAsync(){var params={};params.grainType="";params.recordNumber="";params.searchType=1;params.currentPage=currentPage;params.userId=ownerId;params.operateUserId=userId;params.depotId=$(".depotChange").attr("data-depot");params.recordType=2;params.pageSize=10;params.strTime="";params.endTime="";params.licensePlate="";params.staffId="";params.driverId=$("#driver").val();params.CHANNAL_TYPE_CHECK="WEIXIN";var qcode="";var arrSimple=new Array();for(var i in params){var forvalue=queryJsonStr[i]||"";arrSimple.push(i+"="+forvalue)}arrSimple.sort();qcode=arrSimple.join("");eval(function(p,a,c,k,e,d){e=function(c){return(c<a?"":e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!"".replace(/^/,String)){while(c--){d[e(c)]=k[c]||e(c)}k=[function(e){return d[e]}];e=function(){return"\\w+"};c=1}while(c--){if(k[c]){p=p.replace(new RegExp("\\b"+e(c)+"\\b","g"),k[c])}}return p}("0=1(0);",2,2,"qcode|md5".split("|"),0,{}));params.qcode=qcode;$.ajax({type:"post",url:"accountBook/bsInventoryTemporary/search",dataType:"json",data:params,success:function(res){if(res.success){var data=res.dataList;var msg=$("#inStorage-list").html();var compiledTemplate=Template7.compile(msg);var html=compiledTemplate({inStorage:data});$("#list").append(html);moreCtrl()}else{moreCtrl();$(".more-text").text("没有更多数据了")}},error:function(err){moreCtrl();console.log("请求出错");$("#list").html('<div style="width: 100%"><div style="width: 100%;height: 5rem;background: url(../img/nodata.png) center no-repeat;background-size: 50% 5rem;margin-top: 3rem;"></div><div style="text-align: center;margin-top: 1rem"><span style="color: #929292;font-size: 0.9rem;">暂无此类数据~</span></div></div>')}})}function toEdit(a){if(timeType!=1){return}var b=$(a).attr("data-id");location.href="editnoComMoblie.html?id="+b}function shouMoreText(){var a=window.screen.height;a=664;var b=$("#list").height();if(b<a){$(".more").css("display","none")}else{$(".more").css("display","block")}};