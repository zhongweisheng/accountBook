$(".leftContent > div:nth-child(6)> p:nth-child(6)").addClass("left_active");$(".leftContent > div:nth-child(5)").addClass("left_active");var paidMoney,unpaidMoney;var searchType=1;var currentPage=1;var pages;var depot="0";var name="";var searchStaffId="";var userId=DES3.decrypt(localStorage.getItem("userId"));var ownerId=DES3.decrypt(localStorage.getItem("ownerId"));var userName=DES3.decrypt(localStorage.getItem("userName"));getData();initPaging();var select2Array=[];var person=Restful.post("bsinventorystaff/list",{userId:ownerId,staffType:1,pageSize:1000});if(person){if(person.success){var personArr=person.dataList;select2Array.push({id:0,text:"请选择",phone:""});$.each(personArr,function(a,b){select2Array.push({id:b.staffId,text:b.trueName,phone:b.phone})})}else{select2Array.push({id:0,text:"无",phone:""})}}$("#salePerson").select2({data:select2Array,templateResult:formatState});function formatState(b){if(!b.id){return b.text}var a="";if(b.text!="请选择"){a=$('<span style="display: inline-block;height: 2rem;">姓名: '+b.text+"</br><span>手机号:"+b.phone+"</span></span>")}else{a=$('<span style="display: inline-block;">'+b.text+"</span>")}return a}$("#salePerson").on("change",function(){searchStaffId=$("#salePerson").val();currentPage=1;getData();if(searchType!=1){deleteTd();changePerson()}else{$(".rightContent td").css("display","table-cell")}});var depotre=Restful.post("bsinventorydepot/getDepots",{userId:userId});if(depotre){var html='<option value="0">请选择</option>';for(var i=0,len=depotre.length;i<len;i++){html+=' <option value="'+depotre[i].id+'" >'+depotre[i].name+"</option>"}$(".depot").html("").append(html)}$("#depot").on("change",function(){depot=$("#depot").val();currentPage=1;getData()});$(".page").on("click",function(a){currentPage=$(".activP").text();getData(1)});function getData(a){var c={};c.grainType=1;c.currentPage=currentPage;c.searchType=searchType;c.userId=ownerId;c.operateUserId=userId;c.depotId=depot;c.recordType=3;c.pageSize=10;c.staffName=name;c.staffId=searchStaffId;var h=Restful.post("bsinventorystorage/search",c);if(h.success){var d=h.dataList;for(var e=0,g=d.length;e<g;e++){if(d[e].paidMoney==""){d[e].paidMoney=0}if(searchType==1&&d[e].paidMoney!=""){d[e].paidMoney=d[e].paidMoney.split(",").join("")}if(d[e].unpaidMoney==""){d[e].unpaidMoney=d[e].money}}var b=$("#inTable-list").html();var j=Template7.compile(b);var f=j({inTable:d});$("#list").html(f);pages=Math.ceil(h.total/10);if(a==1){}else{initPaging()}}else{pages=1;initPaging();$("#list").html("");$("#list").html('<tr><td colspan="12"><div style="width: 100%;height: 400px;line-height: 400px;font-size: 30px;text-align: center;margin:0 auto;color: #c1c1c1;text-shadow: #999999;">暂无数据</div>')}}function initPaging(){$(".page").page({leng:pages,activeClass:"activP"})}function toEdit(a){var b=$(a).attr("data-id");location.href="editStorage.html?id="+b}function showEdit(){if(searchType!=1){deleteTd()}else{$(".rightContent td").css("display","table-cell")}if(currentPage==1){$(".edit").css("display","inline-block")}}function fmoney(b,d){d=d>0&&d<=20?d:2;b=parseFloat((b+"").replace(/[^\d\.-]/g,"")).toFixed(d)+"";var a=b.split(".")[0].split("").reverse(),c=b.split(".")[1];t="";for(i=0;i<a.length;i++){t+=a[i]+((i+1)%3==0&&(i+1)!=a.length?",":"")}return t.split("").reverse().join("")+"."+c}var thatId,hasSettled,notSettled;$("#list").on("click",".balance",function(){thatId=$(this).attr("data-id");$(".balanceModel input").val("");var a=$(this).parent().parent().children("td");$(".b-staffName").html(a.eq(2).html()?a.eq(2).html():"无");$(".b-date").html(a.eq(1).html());$(".b-netWeight").html(a.eq(6).html().split(",").join(""));hasSettled=parseFloat(a.eq(7).html().split(",").join(""));$(".b-hasSettled").html(hasSettled);notSettled=parseFloat(a.eq(8).html().split(",").join(""));$(".b-notSettled").html(notSettled);$(".balanceModel").animate({left:"0"},500)});var testNum=true;function calcu(){var b=parseFloat($("#settleCount").val());var a=parseFloat($("#settlePrice").val());var c=b*a*2;$("#shouldPay").html(c?c.toFixed(2):0);$(".b-hasSettled").html(hasSettled+b);$(".b-notSettled").html(notSettled-b);$(".settleCount").html(b);$(".settlePrice").html(a)}$("#settleCount,#settlePrice").keyup(function(){calcu()});$("#actualPay").keyup(function(){$(".actualPay").html($(this).val())});$("#b-cencel").on("click",function(){$(".balanceModel").animate({left:"100%"},500)});$(document).on("click","#b-confirm",function(){if(($(".b-hasSettled").html()>notSettled)||($(".b-notSettled").html()<0)){alert("今日结算数大于未结算数");testNum=false}else{testNum=true}if(testNum){$(".b-write").animate({left:"-50%"},500);$(".b-yes").animate({left:"50%"},500)}});$("#b-back").on("click",function(){$(".b-write").animate({left:"50%"},500);$(".b-yes").animate({left:"150%"},500)});$("#b-submit").on("click",function(){var b={};b.operateUserName=userName;b.operateUserId=userId;b.storageId=thatId;b.settleCount=$("#settleCount").val();b.settlePrice=$("#settlePrice").val();b.shouldPay=$("#shouldPay").html();b.actualPay=$("#actualPay").val();b.hasSettled=$(".b-hasSettled").html();b.notSettled=$(".b-notSettled").html();if(testNum){var a=Restful.post("bsinventorystoragepay",b);if(a&&a.success){$(".balanceModel").hide();alert("结算成功");window.location.reload()}else{alert("结算不成功");$(".balanceModel").hide()}}});$("#list").on("click",".print",function(){var a=$(this).attr("data-id");window.open("dataPrintStorage.html?id="+a)});$("#list").on("click",".details",function(){var a=$(this).attr("data-id");window.location.href="storageDetails.html?id="+a});$("#list").on("click",".delete",function(){var d=$(this).attr("data-id");var b=confirm("是否删除本条数据?");if(b){var c={};c.recordId=d;var a=Restful.post("bsinventorystorage/deleteRecordOrdre",c);if(a.success){getData()}}});function rptDownLoad(){var c=$("<form>");c.attr("style","display:none");c.attr("target","");c.attr("method","post");c.attr("action","/accountBook/bsinventorystorage/export");var b=$("<input>");b.attr("type","hidden");b.attr("name","grainType");b.attr("value",1);var a=$("<input>");a.attr("type","hidden");a.attr("name","searchType");a.attr("value",1);var e=$("<input>");e.attr("type","hidden");e.attr("name","userId");e.attr("value",ownerId);var d=$("<input>");d.attr("type","hidden");d.attr("name","recordType");d.attr("value",3);$("body").append(c);c.append(b);c.append(a);c.append(e);c.append(d);c.submit();c.remove()}function excelBtn(){if(confirm("导出表格?")){rptDownLoad()}};