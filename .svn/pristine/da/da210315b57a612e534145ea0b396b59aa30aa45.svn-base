var unslider04=$("#b04").unslider({dots:true,complete:function(){}}),data04=unslider04.data("unslider");$(".unslider-arrow04").click(function(){var a=this.className.split(" ")[1];data04[a]()});var locationNum,locationText,newPhone,newUserId;$(".addressSelete").citys({required:false,nodata:"disabled",onChange:function(a){console.log(a);locationText=a.province+a.city+a.area;locationNum=a.code}});$(document).on("click","#register",function(){$(".registerModel input").val("");$(".registerModel .reminder").css("display","none");$(".registerModel").fadeIn(200)});$(document).on("click","#registerSbu",function(){if($(this).hasClass("disable")){return}var h=$("#username").val();var b=$("#phone").val();var g=$("#phoneCode-r").val();var c=$("#phoneCode-iv").val();var d=md5($("#password").val());if(!h){var e=$("#username ~ p").css("display","block");return}if(!b){var e=$("#phone ~ p").css("display","block");return}if(!g){var e=$("#phoneCode-r").parent().nextAll("p").css("display","block");return}if(!d){var e=$("#password ~ p").css("display","block");return}if(!$("#agreeInput").prop("checked")){alert("请同意协议后提交");return false}var f={};f.userName=h;f.loginName=b;f.smscode=g;f.invitecode=c;f.password=d;f.location=locationNum;f.locationDesc=locationText;var a=Restful.post("bsinventoryuser",f);$(this).addClass("disable");if(a){if(a.success){alert("注册成功");localStorage.setItem("userName",DES3.encrypt(a.retObj.userName));localStorage.setItem("userType",a.retObj.userType);localStorage.setItem("userId",DES3.encrypt(a.retObj.userId));if(a.retObj.userType==1){localStorage.setItem("ownerId",DES3.encrypt(a.retObj.userId));location.href="accountCharts.html"}else{localStorage.setItem("ownerId",DES3.encrypt(a.retObj.ownerId));location.href="inForm.html"}}else{alert(a.description);$(this).removeClass("disable")}}else{alert("注册失败,请稍后再试");$(this).removeClass("disable")}});$(document).on("click",".getPhoneCode",function(){if($(this).hasClass("disable")){alert("验证码已发送,请稍后再次获取验证码");return}var b=$(this).attr("page-type");var d,a;if(b==3){d=$(".loginName");a=newPhone}else{d=$(this).parent().parent().prev().find("input");a=d.val()}var e=$(this).parent().nextAll("p");if(!(a.length==11)){d.nextAll("p").css("display","block");return false}if(!a.match(/^1[3,5,8,7]\d{9}$/g)){d.nextAll("p").css("display","block");return false}var c=$(this);c.addClass("disable");getPhoneCode(c,e,a,b)});$(document).on("click","#findPassword",function(){$(".findPassWordModel input").val("");$(".findPassWordModel .reminder").css("display","none");$(".findPassWordModel").fadeIn(200)});$(document).on("click","#findPasswordSbu",function(){if($(this).hasClass("disable")){return}var b=$("#phone-f").val();var c=$("#phoneCode-f").val();var d=md5($("#password-f").val());if(!b){$("#phone-f").nextAll("p").css("display","block");return}if(!c){$("#phoneCode-f").parent().nextAll("p").css("display","block").html("请输入验证码");return}if(!d){$("#password-f").nextAll("p").css("display","block");return}var e={};e.phone=b;e.smscode=c;e.password=d;var a=Restful.post("bsinventoryuser/getBackPassword",e);$(this).addClass("disable");if(a){if(a.success){alert("找回密码成功");localStorage.setItem("userName",DES3.encrypt(a.retObj.userName));localStorage.setItem("userType",a.retObj.userType);localStorage.setItem("userId",DES3.encrypt(a.retObj.userId));if(a.retObj.userType==1){localStorage.setItem("ownerId",DES3.encrypt(a.retObj.userId));location.href="accountCharts.html"}else{localStorage.setItem("ownerId",DES3.encrypt(a.retObj.ownerId));location.href="inForm.html"}}else{alert(a.description);$(this).removeClass("disable")}}else{alert("请求失败,请稍后再试");$(this).removeClass("disable")}});$("body").bind("keyup",function(a){if(a.keyCode==13){$("#loginbtn").click()}});$(document).on("click","#loginbtn",function(){if($(this).hasClass("disable")){return}var c=$("#loginName").val();var b=$("#password-login").val();newPhone=c;if(!c){$("#loginName").nextAll("P").html("请输入手机号");return}if(!b){$("#password-login").nextAll("P").html("请输入密码");return}b=md5(b);var d={};d.loginName=c;d.password=b;var a=Restful.post("bsinventoryuser/login",d);$(this).addClass("disable");if(a){if(a.success){if(a.retcode==20000){$(".newStaffModel").show();newUserId=a.retObj.userId}else{localStorage.setItem("userName",DES3.encrypt(a.retObj.userName));localStorage.setItem("userType",a.retObj.userType);localStorage.setItem("userId",DES3.encrypt(a.retObj.userId));if(a.retObj.userType==1){localStorage.setItem("ownerId",DES3.encrypt(a.retObj.userId));location.href="accountCharts.html"}else{localStorage.setItem("ownerId",DES3.encrypt(a.retObj.ownerId));location.href="inForm.html"}}}else{alert(a.description);$(this).removeClass("disable")}}else{alert("登录失败,请稍后再试");$(this).removeClass("disable")}});$(document).on("click","#register-new",function(){var b={};b.userId=newUserId;b.smscode=$("#phoneCode-new").val();var a=Restful.post("bsinventoryuser/setActive",b);if(a&&a.success){localStorage.setItem("userId",DES3.encrypt(a.retObj.userId));localStorage.setItem("userName",DES3.encrypt(a.retObj.userName));localStorage.setItem("userType",a.retObj.userType);localStorage.setItem("ownerId",DES3.encrypt(a.retObj.ownerId));location.href="inForm.html"}});$(document).on("blur",".form input",function(){if($(this).val()){$(this).nextAll("p").css("display","none")}});$(document).on("blur",".logoin-form input",function(){if($(this).val()){$(this).nextAll("p").html("")}});$(document).on("click","#cencel-r",function(){$(".registerModel").fadeOut(200);$(".registerModel input").val("")});$(document).on("click","#cencel-new",function(){$(".registerModel").fadeOut(200);$(".registerModel input").val("");$("#loginbtn").removeClass("disable")});$(document).on("click","#cencel-f",function(){$(".findPassWordModel").fadeOut(200);$(".findPassWordModel input").val("")});$("#openAgreeModal").on("click",function(){$(".agreeModal").show()});$(".agreeBtn").on("click",function(){$(".agreeModal").hide()});function getPhoneCode(d,f,b,a){var c=60;$.ajax({url:"/accountBook/common/sendSmsCode?phone="+b+"&pageType="+a,type:"get",dataType:"json",success:function(e){console.log(e);if(e.success){f.css("display","block");var g=setInterval(function(){c-=1;if(c<=0){clearInterval(g);d.removeClass("disable");f.html("")}else{f.html('短信已发送，如未收到，请<span style="color:red;">'+c+"</span>s后再次获取")}},1000)}else{d.removeClass("disable");alert(e.message)}},error:function(e){console.log(e)}})};