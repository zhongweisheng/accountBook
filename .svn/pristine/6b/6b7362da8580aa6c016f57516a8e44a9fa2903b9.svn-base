var paidMoney,unpaidMoney;var grainType=2;var searchType=1;var currentPage=1;var pages;var name="";var searchStaffId="";var userId=DES3.decrypt(localStorage.getItem("userId"));if(fromId==1||fromId==""){$(".right").addClass("leftborder")}getData();initPaging();var select2Array=[];var person=Restful.post("bsinventorystaff/list",{userId:userId,staffType:1,pageSize:1000});if(person){if(person.success){var personArr=person.dataList;select2Array.push({id:0,text:"请选择",phone:""});$.each(personArr,function(a,b){select2Array.push({id:b.staffId,text:b.trueName,phone:b.phone})})}else{select2Array.push({id:0,text:"无",phone:""})}}$("#salePerson").select2({data:select2Array,templateResult:formatState});function formatState(b){if(!b.id){return b.text}var a="";if(b.text!="请选择"){a=$('<span style="display: inline-block;height: 2rem;">姓名: '+b.text+"</br><span>手机号:"+b.phone+"</span></span>")}else{a=$('<span style="display: inline-block;">'+b.text+"</span>")}return a}$(".leftContent > div:nth-child(6)> p:nth-child(2)").addClass("left_active");$(".leftContent > div:nth-child(5)").addClass("left_active");$(".child").eq(2).css("display","block");$(document).on("mouseover","#accountRemark",function(){$(this).siblings("div").slideDown(100)});$(document).on("mouseout","#accountRemark",function(){$(this).siblings("div").css("display","none")});function deleteTd(){$(".rightContent thead > tr > td:nth-child(8)").css("display","none");$(".rightContent tbody > tr > td:nth-child(8)").css("display","none");$(".rightContent thead > tr > td:nth-child(10)").css("display","none");$(".rightContent tbody > tr > td:nth-child(10)").css("display","none");$(".rightContent thead > tr > td:nth-child(12)").css("display","none");$(".rightContent tbody > tr > td:nth-child(12)").css("display","none")}function changePerson(){var a=$("#salePerson").find("option:selected").text();if(a!="请选择"){$(".staffName").html(a)}else{$(".staffName").html("全部")}}$("#timeChange").on("click","a",function(){if($(this).attr("id")=="excelBtn"){return}searchType=$(this).attr("data-timeType");currentPage=1;getData();if(searchType!=1){deleteTd();changePerson()}else{$(".rightContent td").css("display","table-cell")}$(this).removeClass("watch").addClass("watchActive");$(this).parent().siblings().find("a").removeClass("watchActive").addClass("watch")});$("#grainType").on("change",function(){grainType=$("#grainType").val();currentPage=1;getData();if(searchType!=1){deleteTd();changePerson()}else{$(".rightContent td").css("display","table-cell")}});$("#salePerson").on("change",function(){searchStaffId=$("#salePerson").val();currentPage=1;getData();if(searchType!=1){deleteTd();changePerson()}else{$(".rightContent td").css("display","table-cell")}});$(".page").on("click",function(a){currentPage=$(".activP").text();getData(1);if(searchType!=1){deleteTd();changePerson()}else{$(".rightContent td").css("display","table-cell")}});function getData(a){var c={};c.grainType=grainType;c.currentPage=currentPage;c.searchType=searchType;c.userId=userId;c.recordType=1;c.pageSize=10;c.staffName=name;c.staffId=searchStaffId;var h=Restful.post("bsinventoryrecord/search",c);if(h.success){var d=h.dataList;for(var e=0,g=d.length;e<g;e++){if(d[e].paidMoney==""){d[e].paidMoney=0}if(searchType==1&&d[e].paidMoney!=""){d[e].paidMoney=d[e].paidMoney.split(",").join("")}if(d[e].unpaidMoney==""){d[e].unpaidMoney=d[e].money}}var b=$("#inTable-list").html();var j=Template7.compile(b);var f=j({inTable:d});$("#list").html(f);pages=Math.ceil(h.total/10);if(a==1){}else{initPaging()}}else{pages=1;initPaging();$("#list").html("");$("#list").html('<tr><td colspan="12"><div style="width: 100%;height: 400px;line-height: 400px;font-size: 30px;text-align: center;margin:0 auto;color: #c1c1c1;text-shadow: #999999;">暂无数据</div>')}}function initPaging(){$(".page").page({leng:pages,activeClass:"activP"})}function rptDownLoad(){var c=$("<form>");c.attr("style","display:none");c.attr("target","");c.attr("method","post");c.attr("action","/accountBook/bsinventoryrecord/export");var b=$("<input>");b.attr("type","hidden");b.attr("name","grainType");b.attr("value",grainType);var a=$("<input>");a.attr("type","hidden");a.attr("name","searchType");a.attr("value",searchType);var e=$("<input>");e.attr("type","hidden");e.attr("name","userId");e.attr("value",userId);var d=$("<input>");d.attr("type","hidden");d.attr("name","recordType");d.attr("value",1);$("body").append(c);c.append(b);c.append(a);c.append(e);c.append(d);c.submit();c.remove()}$("#excelBtn").on("click",function(){if(confirm("导出表格?")){rptDownLoad()}});function toEdit(a){var b=$(a).attr("data-id");location.href="edit.html?id="+b}function showEdit(){if(searchType!=1){deleteTd()}else{$(".rightContent td").css("display","table-cell")}if(currentPage==1){$(".edit").css("display","inline-block")}}function fmoney(b,d){d=d>0&&d<=20?d:2;b=parseFloat((b+"").replace(/[^\d\.-]/g,"")).toFixed(d)+"";var a=b.split(".")[0].split("").reverse(),c=b.split(".")[1];t="";for(i=0;i<a.length;i++){t+=a[i]+((i+1)%3==0&&(i+1)!=a.length?",":"")}return t.split("").reverse().join("")+"."+c}$("#list").on("focus",".paidMoney",function(){$(this).val("")});$("#list").on("click","#print",function(){var a=$(this).attr("data-id");window.open("dataPrint.html?id="+a)});$("#list").on("click","#delete",function(){var d=$(this).attr("data-id");var b=confirm("是否删除本条数据?");if(b){var c={};c.recordId=d;var a=Restful.post("bsinventoryrecord/deleteRecordOrdre",c);if(a.success){getData()}}});$("#list").on("click",".changepay",function(){$(this).hide();$(this).next().show();$(this).siblings("input").prop("disabled",false)});$("#list").on("input",".paidMoney",function(){paidMoney=$(this).val()||"0";var a=$(this).parent().siblings(".money").html().split(",").join("");unpaidMoney=parseFloat(a)-parseFloat(paidMoney);$(this).parents().siblings(".unpaidMoney").html(fmoney(unpaidMoney))});$("#list").on("click",".pay",function(){paidMoney=$(this).siblings("input").val();if(paidMoney==""){alert("请输入付款金额");return}var c=$(this).attr("data-id");$(this).hide();$(this).siblings("input").prop("disabled",true);$(this).siblings("span").show();var b={};b.id=c;b.paidMoney=paidMoney;b.unpaidMoney=unpaidMoney||"0";var a=Restful.post("bsinventoryrecord/updatePaidMoney",b);if(a.success){}else{alert("修改未成功")}});$("#list").on("click",".delete",function(){var d=$(this).attr("data-id");var b=confirm("是否删除本条数据?");if(b){var c={};c.recordId=d;var a=Restful.post("bsinventoryrecord/deleteRecordOrdre",c);if(a.success){getData();if(searchType!=1){deleteTd()}else{$(".rightContent td").css("display","table-cell")}}}});