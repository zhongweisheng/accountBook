var userId=DES3.decrypt(localStorage.getItem("userId"));$(".leftContent > div:nth-child(8)> p:nth-child(2)").addClass("left_active");$(".leftContent > div:nth-child(7)").addClass("left_active");$(".child").eq(3).css("display","block");getData();$("#checkAll").change(function(){if($(this).prop("checked")==true){$("#select :checkbox").prop("checked",true)}else{$("#select :checkbox").prop("checked",false)}});$("#select").on("change"," :checkbox",function(){allchk()});function allchk(){var a=$("#select :checkbox").size();var b=0;$("#select :checkbox").each(function(){if($(this).prop("checked")==true){b++}});if(a==b){$("#checkAll").prop("checked",true)}else{$("#checkAll").prop("checked",false)}}$("#checkAll-edit").change(function(){if($(this).prop("checked")==true){$("#select-edit :checkbox").prop("checked",true)}else{$("#select-edit :checkbox").prop("checked",false)}});$("#select-edit").on("change"," :checkbox",function(){allchkEdit()});function allchkEdit(){var a=$("#select-edit :checkbox").size();var b=0;$("#select-edit :checkbox").each(function(){if($(this).prop("checked")==true){b++}});if(a==b){$("#checkAll-edit").prop("checked",true)}else{$("#checkAll-edit").prop("checked",false)}}$(document).on("click","#submit",function(){var e=new Array;$("#select :checkbox:checked").each(function(h){e[h]=$(this).attr("data-id")});var f=e.join(",");var d=$("#name").val();var b=$("#phone").val();var c=$("#password").val();if(!b){$("#phone").nextAll("p").css("display","inline-block");return}if(!c){$("#password").nextAll("p").css("display","inline-block");return}var g={};g.ownerId=userId;g.action="add";g.trueName=d;g.phone=b;g.loginName=b;g.passWord=md5(c);g.depotIds=f;var a=Restful.post("bsinventoryuser/editUser",g);if(a){if(a.success){getData();$(".registerModel").fadeOut(200)}else{if(a.retcode==2000){alert("手机号已经被占用")}else{alert("员工添加失败")}}}else{alert("账号别处登录或者网络有问题")}});var depotHtml="";function getDepot(){var e={};e.userId=userId;var c=Restful.post("bsinventorydepot/list",e);if(c&&c.success){var d=c.dataList;depotHtml="";for(var b=0,a=d.length;b<a;b++){depotHtml+='<li class="choice-con lt"><input type="checkbox" data-id="'+d[b].id+'" id="'+d[b].id+'"><label for="'+d[b].id+'">'+d[b].name+"</label></li>"}}else{alert("获取粮库信息失败")}}function getData(){var f={};f.ownerId=userId;var c=Restful.post("bsinventoryuser/list",f);if(c.success){var d=c.dataList;var e=$("#salePerson-list").html();var a=Template7.compile(e);var b=a({salePerson:d});$("#list").html(b);if(c.total>30){$("#add").addClass("disable")}}else{$("#list").html("");$("#list").html('<tr><td colspan="6"><div style="width: 100%;height: 400px;line-height: 100px;font-size: 30px;text-align: center;margin:0 auto;color: #c1c1c1;text-shadow: #999999;">暂无数据</div>')}}$(document).on("click","#add",function(){if($("#add").hasClass("disable")){alert("添加员工数达到上限")}else{$(".register-form input,textarea").val("");$("#addP").fadeIn(200);getDepot();$("#select").html("").append(depotHtml)}});$(document).on("click","#cencel",function(){$(".registerModel").fadeOut(200);$(".register-form input,textarea").val("")});$(document).on("click","#deletebtn",function(){$("#deletebtn").removeClass("disable");var c=$(this).attr("data-id");var b=confirm("确定删除本条记录?");if(b){var a=Restful.deletestaff("bsinventoryuser/"+c);if(a){if(a.success){getData()}else{alert("员工删除失败")}}else{alert("账号别处登录或者网络有问题")}}});var staffId,passVal;$(document).on("click","#editbtn",function(){$("#edit").fadeIn(200);getDepot();$("#select-edit").html("").append(depotHtml);var c=$(this).attr("data-id");staffId=c;var a=Restful.get("bsinventoryuser/"+c+"?depotIds=1");if(a){var b=a.userImage.split(",");$("#select-edit :checkbox").each(function(e,f){for(var e=0,d=b.length;e<d;e++){if($(f).attr("data-id")==b[e]){$(f).prop("checked",true)}}});$("#name-edit").val(a.trueName);$("#phone-edit").val(a.phone);$("#password-edit").val("********");passVal=a.passWord}});$(document).on("click","#editSubmit",function(){var e=new Array;$("#select-edit :checkbox:checked").each(function(h){e[h]=$(this).attr("data-id")});var f=e.join(",");var d=$("#name-edit").val();var b=$("#phone-edit").val();var c=$("#password-edit").val();if(!b){$("#phone").nextAll("p").css("display","inline-block");return}if(!c){$("#password").nextAll("p").css("display","inline-block");return}var g={};g.ownerId=userId;g.userId=staffId;g.trueName=d;g.phone=b;g.loginName=b;if(c=="********"){g.passWord=passVal}else{g.passWord=md5(c)}g.depotIds=f;var a=Restful.post("bsinventoryuser/editUser",g);if(a){if(a.success){getData();$("#edit").fadeOut(200)}else{alert("员工编辑失败")}}else{alert("账号别处登录或者网络有问题")}});$(document).on("click","#editCencel",function(){$("#edit").fadeOut(200)});