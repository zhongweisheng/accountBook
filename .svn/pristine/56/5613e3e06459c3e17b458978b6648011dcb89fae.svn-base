var mlbUserId=localStorage.getItem("mlbUserId");if(!mlbUserId){window.location.href="entry.html?type=9"}var $$=$.noConflict();var locationText,locationNum=0;$$(".addressSelete").citys({required:false,nodata:"disabled",onChange:function(a){console.log(a);locationText=a.province+a.city+a.area;locationNum=a.code}});var cornRange=[720,[685,719],[650,684],[620,649],[590,619]];var wheatRange=[790,[770,789],[750,769],[730,749],[710,729]];function weightRange(a,b){var d=Math.floor($("#quality").val());var c=Math.floor($("#weight").val());if(d==1){if(c<a){$.alert("输入范围：≥"+a);$("#weight").val("")}}else{if(c<b[d-1][0]||c>=b[d-1][1]){$.alert("输入范围："+b[d-1][0]+"~"+b[d-1][1]);$("#weight").val("")}}}$("#weight").on("change",function(){var a=Math.floor($("#cropsType").val());if(a==2){weightRange(720,cornRange)}else{weightRange(790,wheatRange)}});var delay=500;var qtime=new Date();$("#quality").on("focus",function(){qtime=new Date()}).on("blur",function(a){if(new Date().getTime()-qtime.getTime()<delay){$("#quality").focus()}});function weightRange2(a,b){var d=Math.floor($("#quality").val());var c=Math.floor($("#weight").val());if(d==1){if(c<a&&c>0){$.alert("输入范围：≥"+a);$("#weight").val("")}$("#weight").attr("placeholder","输入范围：≥"+b[d-1])}else{if((c>0&&c<b[d-1][0])||c>=b[d-1][1]){$.alert("输入范围："+b[d-1][0]+"~"+b[d-1][1]);$("#weight").val("")}$("#weight").attr("placeholder","输入范围："+b[d-1][0]+"~"+b[d-1][1])}}function weightChange(){var a=Math.floor($("#cropsType").val());if(a==2){weightRange2(720,cornRange)}else{weightRange2(790,wheatRange)}}$("#quality").on("change",function(){weightChange()});$("#cropsType").on("change",function(){weightChange()});$("#submit").click(function(){if(!checkForm()){return false}if($(this).hasClass("disabled")){return}$(this).addClass("disabled");var a={};a.userId=mlbUserId;a.foodType=$("#cropsType").val();a.serviceType=$("#serviceType").val();a.foodNum=$("#ton").val();a.foodPrice=$("#price").val();a.locationDesc=locationText;a.location=locationNum;a.address=$("#address").val();a.grainLevel=$("#quality").val();if($("#cropsType").val()==2){a.ATTR_7=$("#water").val();a.ATTR_13=$("#weight").val();a.ATTR_5=$("#mildew").val();a.ATTR_15=$("#noperfect").val();a.ATTR_16=$("#impurity").val();a.ATTR_14=$("#qremarks").val();a.foodRequire="水分(%):"+a.ATTR_7+",容重(g/l):"+a.ATTR_13+",生霉粒(%):"+a.ATTR_5+",不完善粒(%):"+a.ATTR_15+",杂质(%):"+a.ATTR_16+",品质备注："+a.ATTR_14}else{a.ATTR_6=$("#water").val();a.ATTR_8=$("#weight").val();a.ATTR_10=$("#mildew").val();a.ATTR_17=$("#noperfect").val();a.ATTR_18=$("#impurity").val();a.ATTR_11=$("#qremarks").val();a.foodRequire="水分(%):"+a.ATTR_6+",容重(g/l):"+a.ATTR_8+",生霉粒(%):"+a.ATTR_10+",不完善粒(%):"+a.ATTR_17+",杂质(%):"+a.ATTR_18+",品质备注："+a.ATTR_11}a.remark=$("#remarks").val();a.hasInvoice=$("#invoice").val();a.hasLogistics=$("#logistics").val();$.ajax({type:"post",url:"accountBook/bsgoodsinfo",dataType:"json",async:false,data:a,success:function(b){if(b.success){window.location.href="downstream.html"}else{$.toast("操作失败");$(this).removeClass("disabled")}},error:function(b){$(this).removeClass("disabled");console.log("err"+b)}})});$.init();function checkForm(){var a=/^[1-9]\d?(\.\d{1}|0\.\d{1})?$/;if(!$("#ton").val()){$.toast("请输入数量");return false}if(!locationNum){$.toast("请输入发货地址");return false}if(!$("#price").val()||$("#price").val()>2800||$("#price").val()<900){$.toast("请输入正确价格");$("#price").val("");return false}if(!$("#address").val()){$.toast("请输入详细地址");return false}if(!$("#water").val()){$.toast("请输入水分");return false}if(!a.test($("#water").val())){$.toast("输入正确水分格式,整数或者一位小数");$("#water").val("");return false}if(!$("#weight").val()){$.toast("请输入容重");return false}if(!$("#mildew").val()){$.toast("请输入生霉粒");return false}if(!a.test($("#mildew").val())){$.toast("输入正确生霉粒格式,整数或者一位小数");$("#mildew").val("");return false}if(!$("#impurity").val()){$.toast("请输入杂质");return false}if(!a.test($("#impurity").val())){$.toast("输入正确杂质格式,整数或者一位小数");$("#impurity").val("");return false}if($("#noperfect").val()!=null){if(!a.test($("#noperfect").val())){$.toast("输入正确不完善粒格式,整数或者一位小数");$("#noperfect").val("");return false}}return true};