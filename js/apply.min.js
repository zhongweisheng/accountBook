var mlbUserId=localStorage.getItem("mlbUserId");if(!mlbUserId){window.location.href="entry.html?type=9"}var $$=$.noConflict();var locationText,locationNum=0;$$(".addressSelete").citys({required:false,nodata:"disabled",onChange:function(a){console.log(a);locationText=a.province+a.city+a.area;locationNum=a.code}});var cornRange=[720,[685,719],[650,684],[620,649],[590,619]];var wheatRange=[790,[770,789],[750,769],[730,749],[710,729]];function weightRange(a,b){var d=Math.floor($("#quality").val());var c=Math.floor($("#weight").val());if(d==1){if(c<a){$.alert("输入范围：≥"+a);$("#weight").val("")}}else{if(c<b[d-1][0]||c>=b[d-1][1]){$.alert("输入范围："+b[d-1][0]+"~"+b[d-1][1]);$("#weight").val("")}}}$("#weight").on("change",function(){var a=Math.floor($("#cropsType").val());if(a==2){weightRange(720,cornRange)}else{weightRange(790,wheatRange)}});var delay=500;var qtime=new Date();$("#quality").on("focus",function(){qtime=new Date()}).on("blur",function(a){if(new Date().getTime()-qtime.getTime()<delay){$("#quality").focus()}});function weightRange2(a,b){var d=Math.floor($("#quality").val());var c=Math.floor($("#weight").val());if(d==1){if(c<a&&c>0){$.alert("输入范围：≥"+a);$("#weight").val("")}$("#weight").attr("placeholder","输入范围：≥"+b[d-1])}else{if((c>0&&c<b[d-1][0])||c>=b[d-1][1]){$.alert("输入范围："+b[d-1][0]+"~"+b[d-1][1]);$("#weight").val("")}$("#weight").attr("placeholder","输入范围："+b[d-1][0]+"~"+b[d-1][1])}}function weightChange(){var a=Math.floor($("#cropsType").val());if(a==2){weightRange2(720,cornRange)}else{weightRange2(790,wheatRange)}}$("#cropsType,#quality").on("change",function(){weightChange()});$(".right").click(function(){if(!checkForm()){return false}if($(this).hasClass("disabled")){return}$(this).addClass("disabled");var b={};b.userId=mlbUserId;b.foodType=$("#cropsType").val();b.foodNum=$("#ton").val();b.foodPrice=$("#price").val();b.locationDesc=locationText;b.location=locationNum;b.address=$("#address").val();b.grainLevel=$("#quality").val();if($("#cropsType").val()==2){b.ATTR_7=$("#water").val();b.ATTR_13=$("#weight").val();b.ATTR_5=$("#mildew").val();b.ATTR_15=$("#noperfect").val();b.ATTR_16=$("#impurity").val();b.ATTR_14=$("#qremarks").val();b.foodRequire="水分(%):"+b.ATTR_7+",容重(g/l):"+b.ATTR_13+",生霉粒(%):"+b.ATTR_5+",不完善粒(%):"+b.ATTR_15+",杂质(%):"+b.ATTR_16+",品质备注："+b.ATTR_14}else{b.ATTR_6=$("#water").val();b.ATTR_8=$("#weight").val();b.ATTR_10=$("#mildew").val();b.ATTR_17=$("#noperfect").val();b.ATTR_18=$("#impurity").val();b.ATTR_11=$("#qremarks").val();b.foodRequire="水分(%):"+b.ATTR_6+",容重(g/l):"+b.ATTR_8+",生霉粒(%):"+b.ATTR_10+",不完善粒(%):"+b.ATTR_17+",杂质(%):"+b.ATTR_18+",品质备注："+b.ATTR_11}b.remark=$("#remarks").val();b.hasInvoice=$("#invoice").val();b.hasLogistics=$("#logistics").val();var a=Restful.post("bsgoodsinfo",b);if(a&&a.success){window.location.href="Tradeleads.html"}else{$.toast("操作失败");$(this).removeClass("disabled")}});$.init();function checkForm(){var a=/^[1-9]\d?(\.\d{1}|0\.\d{1})?$/;if(!$("#ton").val()){$.toast("请输入数量");return false}if(!locationNum){$.toast("请输入发货地址");return false}if(!$("#price").val()||$("#price").val()>2800||$("#price").val()<900){$.toast("请输入正确价格");$("#price").val("");return false}if(!$("#address").val()){$.toast("请输入详细地址");return false}if(!$("#water").val()){$.toast("请输入水分");return false}if(!a.test($("#water").val())){$.toast("输入正确水分格式,整数或者一位小数");$("#water").val("");return false}if(!$("#weight").val()){$.toast("请输入容重");return false}if(!$("#mildew").val()){$.toast("请输入生霉粒");return false}if(!a.test($("#mildew").val())){$.toast("输入正确生霉粒格式,整数或者一位小数");$("#mildew").val("");return false}return true};