$("#date").datetimepicker({startView:4,minView:2,todayBtn:true,todayHighlight:true,language:"zh-CN"});if(navigator.userAgent.indexOf("Firefox")>=0){$("input[type=number]").on("DOMMouseScroll",function(){return false})}else{$("input[type=number]").on("mousewheel",function(){return false})}var userId=DES3.decrypt(localStorage.getItem("userId"));var ownerId=DES3.decrypt(localStorage.getItem("ownerId"));var isNewPerson,driverstate,locationNum,locationText;$("#deduction").on("focus",function(){if($("#deduction").val()==0||$("#deduction").val()==""){$("#deduction").val("")}});var select2Array=[],driverArray=[],licensePlate=["无"],phoneArray=[""],driverPhone=[""];var person=Restful.post("bsinventorystaff/list",{userId:ownerId,staffType:1,pageSize:1000});if(person){if(person.success){var personArr=person.dataList;select2Array.push({id:0,text:"请选择",phone:""});$.each(personArr,function(a,b){select2Array.push({id:b.staffId,text:b.trueName,phone:b.phone});phoneArray.push(b.phone)})}else{select2Array.push({id:0,text:"无",phone:""})}}$("#salePerson").select2({data:select2Array,templateResult:formatState});var driver=Restful.post("bsinventorystaff/list",{userId:ownerId,staffType:3,pageSize:1000});if(driver){if(driver.success){var driverArr=driver.dataList;driverArray.push({id:0,text:"请选择",phone:""});$.each(driverArr,function(a,b){driverArray.push({id:b.staffId,text:b.trueName,phone:b.phone});licensePlate.push(b.licensePlate);driverPhone.push(b.phone)})}else{driverArray.push({id:0,text:"无",phone:""})}}$("#driver").select2({data:driverArray,templateResult:formatState});$("#driver").on("change",function(){var a=$("#driver").children("option:selected").index();$("#licensePlate").val(licensePlate[a])});function formatState(b){if(!b.id){return b.text}var a="";if(b.text!="请选择"){a=$('<span style="display: inline-block;height: 2rem;">姓名: '+b.text+"</br><span>手机号:"+b.phone+"</span></span>")}else{a=$('<span style="display: inline-block;">'+b.text+"</span>")}return a}$(function(){var d=new Date();var c=d.getFullYear();var e=d.getMonth()+1;if(e<10){e="0"+e}var b=d.getDate();if(b<10){b="0"+b}var a=d.getHours();if(a<10){a="0"+a}var f=d.getMinutes();if(f<10){f="0"+f}nowDate=c+"-"+e+"-"+b;$("#date").val(nowDate)});function Calculation(){var a=$("#grossWeightIn").val();var b=$("#tareWeightIn").val();var c=$("#unitPrice").val();var e=$("#deduction").val();var f=a-b-e;f=f.toFixed(2);var d=f*c*2;d=d.toFixed(2);$("#netWeightIn").val(f);$("#moneyIn").val(d)}$("#grossWeightIn,#tareWeightIn,#unitPrice,#deduction").keyup(function(){Calculation()});$(".addressSelete").citys({required:false,nodata:"disabled",onChange:function(a){locationText=a.province+a.city+a.area;locationNum=a.code}});$(".grain").show();$(".notGrain").hide();$("#grainType").on("change",function(){if($(this).val()==0){$(this).siblings("p").html("请选择入库类型");return false}else{if($(this).val()==1){$(".grain").show();$(".notGrain").hide();$("this").siblings("p").html("")}else{$(".notGrain").show();$(".grain").hide();$("this").siblings("p").html("")}}});function checkForm(){var b=/^[1-9]\d*\.\d{0,2}|[1-9]\d*|0\.\d{0,2}|0$/;var f=/^[1-9]\d*\.\d{1}|[1-9]\d*|0\.\d{1}$/;var g=/^[1-9]\d*\.\d{0,3}|[1-9]\d*|0\.\d{0,3}$/;var e=$("#grainType").val();var c=$("#date").val();var a=$("#grossWeightIn").val();var d=$("#tareWeightIn").val();var h=a-d;if(h<0){alert("皮重不能大于毛重");return false}if($("#addPerson").val()!=""&&$("#phone").val()==""){alert("请填写送粮人手机号");return false}if($("#phone").val()!=""&&$("#addPerson").val()==""){alert("请填写送粮人姓名");return false}if($("#addDriver").val()!=""&&$("#driverPhone").val()==""){alert("请填写司机手机号");return false}if($("#driverPhone").val()!=""&&$("#addDriver").val()==""){alert("请填写司机姓名");return false}if($("#grainType").val()==0){$("#grainType").siblings("p").html("请选择入库类型");return false}else{$("#grainType").siblings("p").html("")}if($("#grossWeightIn").val()==""||$("#grossWeightIn").val()<=0){$("#grossWeightIn").siblings("p").html("请填写毛重后提交");return false}else{$("#grossWeightIn").siblings("p").html("")}if($("#tareWeightIn").val()==""||$("#tareWeightIn").val()<0){$("#tareWeightIn").siblings("p").html("请填写皮重后提交");return false}else{$("#tareWeightIn").siblings("p").html("")}if($("#unitPrice").val()==""||$("#unitPrice").val()<0){$("#unitPrice").siblings("p").html("请填写单价后提交");return false}else{$("#unitPrice").siblings("p").html("")}if(!b.test($("#grossWeightIn").val())){$("#grossWeightIn").siblings("p").html("毛重最多八位整数俩位小数");return false}else{$("#grossWeightIn").siblings("p").html("")}if(!b.test($("#tareWeightIn").val())){$("#tareWeightIn").siblings("p").html("皮重最多八位整数俩位小数");return false}else{$("#tareWeightIn").siblings("p").html("")}if($("#deduction").val()!=null&&$("#deduction").val()!=""&&!b.test($("#deduction").val())){$("#deduction").siblings("p").html("皮重最多八位整数俩位小数");return false}else{$("#deduction").siblings("p").html("")}if(!g.test($("#unitPrice").val())){$("#unitPrice").siblings("p").html("单价最多三位整数三位小数");return false}else{$("#unitPrice").siblings("p").html("")}if(e==1){if($("#waterxm").val()!=""&&!f.test($("#waterxm").val())){$("#waterxm").siblings("p").html("水分最多俩位整数一位小数");return false}else{$("#waterxm").siblings("p").html("")}if($("#buwanshanlixm").val()!=""&&!f.test($("#buwanshanlixm").val())){$("#buwanshanlixm").siblings("p").html("不完善粒最多俩位整数一位小数");return false}else{$("#buwanshanlixm").siblings("p").html("")}if($("#impurityxm").val()!=""&&!f.test($("#impurityxm").val())){$("#impurityxm").siblings("p").html("杂质最多俩位整数一位小数");return false}else{$("#impurityxm").siblings("p").html("")}}else{if($("#water").val()!=""&&!f.test($("#water").val())){$("#water").siblings("p").html("水分最多俩位整数一位小数");return false}else{$("#water").siblings("p").html("")}if($("#meibian").val()!=""&&!f.test($("#meibian").val())){$("#meibian").siblings("p").html("霉变最多俩位整数一位小数");return false}else{$("#meibian").siblings("p").html("")}if($("#buwanshanli").val()!=""&&!f.test($("#buwanshanli").val())){$("#buwanshanli").siblings("p").html("不完善粒最多俩位整数一位小数");return false}else{$("#buwanshanli").siblings("p").html("")}if($("#impurity").val()!=""&&!f.test($("#impurity").val())){$("#impurity").siblings("p").html("杂质最多俩位整数一位小数");return false}else{$("#impurity").siblings("p").html("")}}return true}$("#submit").on("click",function(){if($("#submit").hasClass("disable")){alert("不可重复提交");return}$("#submit").addClass("disable");var h=false;if(!checkForm()){$("#submit").removeClass("disable");return false}var c=$("#date").val();var d={};var l=locationNum;var i=locationText;d.recordType=1;d.userId=ownerId;d.operateUserId=userId;d.depotId=$("#depot").val();d.recordNumber=$("#recordNumber").text().replace("No.","");d.date=c;d.licensePlate=$("#licensePlate").val();var e=$("#grainType").val();if(e==1){d.bulkDensity=$("#rongzhongxm").val();d.imperfectGrains=$("#buwanshanlixm").val();d.moistureContent=$("#waterxm").val();d.impurity=$("#impurityxm").val();d.productQuality=$("#qualityxm").val();d.remark=$("#remarkxm").val();if(d.productQuality!=null&&d.productQuality!=""&&d.productQuality*1>0){if(d.bulkDensity==null||d.bulkDensity==""){alert("请填写容重！");$("#submit").removeClass("disable");return false}if(d.productQuality*1==1){if(d.bulkDensity!=null&&d.bulkDensity!=""&&d.bulkDensity*1<790){alert("质量与容重不匹配，容重必须大于等于 790！");$("#submit").removeClass("disable");return false}}else{if(d.productQuality*1==2){if(d.bulkDensity!=null&&d.bulkDensity!=""&&d.bulkDensity*1<770||d.bulkDensity*1>790){alert("质量与容重不匹配，容重必须大于等于 770，小于790！");$("#submit").removeClass("disable");return false}}else{if(d.productQuality*1==3){if(d.bulkDensity!=null&&d.bulkDensity!=""&&d.bulkDensity*1<750||d.bulkDensity*1>770){alert("质量与容重不匹配，容重必须大于等于 750，小于770！");$("#submit").removeClass("disable");return false}}else{if(d.productQuality*1==4){if(d.bulkDensity!=null&&d.bulkDensity!=""&&d.bulkDensity*1<730||d.bulkDensity*1>750){alert("质量与容重不匹配，容重必须大于等于 730，小于750！");$("#submit").removeClass("disable");return false}}else{if(d.productQuality*1==5){if(d.bulkDensity!=null&&d.bulkDensity!=""&&d.bulkDensity*1<710||d.bulkDensity*1>730){alert("质量与容重不匹配，容重必须大于等于 710，小于730！");$("#submit").removeClass("disable");return false}}else{if(d.productQuality*1==6){if(d.bulkDensity!=null&&d.bulkDensity!=""&&d.bulkDensity*1>710){alert("质量与容重不匹配，容重必须小于 710！");$("#submit").removeClass("disable");return false}}}}}}}}}else{d.bulkDensity=$("#rongzhong").val();d.imperfectGrains=$("#buwanshanli").val();d.moistureContent=$("#water").val();d.impurity=$("#impurity").val();d.mildew=$("#meibian").val();d.productQuality=$("#quality").val();d.remark=$("#remark").val();if(e!=3){if(d.productQuality!=null&&d.productQuality!=""&&d.productQuality*1>0){if(d.bulkDensity==null||d.bulkDensity==""){alert("请填写容重！");$("#submit").removeClass("disable");return false}if(d.productQuality*1==1){if(d.bulkDensity!=null&&d.bulkDensity!=""&&d.bulkDensity*1<720){alert("质量与容重不匹配，容重必须大于等于 720！");$("#submit").removeClass("disable");return false}}else{if(d.productQuality*1==2){if(d.bulkDensity!=null&&d.bulkDensity!=""&&d.bulkDensity*1<685||d.bulkDensity*1>720){alert("质量与容重不匹配，容重必须大于等于 685，小于720！");$("#submit").removeClass("disable");return false}}else{if(d.productQuality*1==3){if(d.bulkDensity!=null&&d.bulkDensity!=""&&d.bulkDensity*1<650||d.bulkDensity*1>685){alert("质量与容重不匹配，容重必须大于等于 650，小于685！");$("#submit").removeClass("disable");return false}}else{if(d.productQuality*1==4){if(d.bulkDensity!=null&&d.bulkDensity!=""&&d.bulkDensity*1<620||d.bulkDensity*1>650){alert("质量与容重不匹配，容重必须大于等于 620，小于650！");$("#submit").removeClass("disable");return false}}else{if(d.productQuality*1==5){if(d.bulkDensity!=null&&d.bulkDensity!=""&&d.bulkDensity*1<590||d.bulkDensity*1>620){alert("质量与容重不匹配，容重必须大于等于 590，小于620！");$("#submit").removeClass("disable");return false}}else{if(d.productQuality*1==6){if(d.bulkDensity!=null&&d.bulkDensity!=""&&d.bulkDensity*1>590){alert("质量与容重不匹配，容重必须小于 590！");$("#submit").removeClass("disable");return false}}}}}}}}}}d.grainType=e;d.grossWeightIn=$("#grossWeightIn").val();d.netWeightIn=$("#netWeightIn").val();d.tareWeightIn=$("#tareWeightIn").val();d.unitPrice=$("#unitPrice").val();d.moneyIn=$("#moneyIn").val();d.paidMoney=$("#paidMoney").val();d.deduction=$("#deduction").val();d.varietyType=$("#varietyType").val();d.packingType=$("#packingType").val();d.productionNiafe=$("#productionNiafe").val();d.smell=$("#smell").val();if(l==undefined){l=""}if(i==undefined){i=""}d.location=l;d.locationDesc=i;if(driverstate){d.driverId=-100;d.driverName=$("#addDriver").val();d.driverPhone=$("#driverPhone").val();if(d.driverPhone!=null&&d.driverPhone!=""){var b={};b.userId=userId;b.staffType=3;b.phone=$("#driverPhone").val();h=Restful.post("bsinventorystaff/isExist",b)}}else{var g=$("#driver").val();if(g!=0){d.driverId=g;d.driverName=$("#driver").find("option:selected").text();var k=$("#driver").children("option:selected").index();d.driverPhone=driverPhone[k]}else{d.driverId="";d.driverName="";d.driverPhone=""}}if(!h){}else{alert("司机手机号已存在");$("#submit").removeClass("disable");return}if(isNewPerson){d.staffId=-100;d.staffName=$("#addPerson").val();d.staffPhone=$("#phone").val();if(d.staffPhone!=null&&d.staffPhone!=""){var b={};b.userId=userId;b.staffType=1;b.phone=$("#phone").val();h=Restful.post("bsinventorystaff/isExist",b)}}else{var f=$("#salePerson").val();if(f!=0){d.staffId=f;d.staffName=$("#salePerson").find("option:selected").text();var k=$("#salePerson").children("option:selected").index();d.staffPhone=phoneArray[k]}else{d.staffId="";d.staffName="";d.staffPhone=""}}$("#submit").addClass("disable");if(!h){var m=$("#depot option:selected").html();if(window.confirm("确定要保存到"+m+"库吗？")){var j=Restful.post("bsinventoryrecord/insert",d);if(j.success){alert("保存成功");Restful.operateRecord(j.retcode,1,11);var a=j.retcode;window.location.href="inFormSuccess.html?id="+a;localStorage.setItem("hrefType","inTable")}else{$("#submit").removeClass("disable");alert("提交失败，稍后再试")}return true}else{$("#submit").removeClass("disable");return false}}else{alert("送粮人手机号已存在");$("#submit").removeClass("disable")}});function checkForms(){var a=/^[1-9]\d*\.\d{0,2}|[1-9]\d*|0\.\d{0,2}|0$/;var d=/^[1-9]\d*\.\d{1}|[1-9]\d*|0\.\d{1}$/;var e=/^[1-9]\d*\.\d{0,3}|[1-9]\d*|0\.\d{0,3}$/;var c=$("#grainType").val();var b=$("#date").val();if($("#grossWeightIn").val()==""&&$("#tareWeightIn").val()==""){alert("毛重和皮重两项必填一项！");return false}if($("#addPerson").val()!=""&&$("#phone").val()==""){alert("请填写送粮人手机号");return false}if($("#phone").val()!=""&&$("#addPerson").val()==""){alert("请填写送粮人姓名");return false}if($("#addDriver").val()!=""&&$("#driverPhone").val()==""){alert("请填写司机手机号");return false}if($("#driverPhone").val()!=""&&$("#addDriver").val()==""){alert("请填写司机姓名");return false}if($("#grainType").val()==0){$("#grainType").siblings("p").html("请选择入库类型");return false}else{$("#grainType").siblings("p").html("")}if($("#grossWeightIn").val()!=null&&$("#grossWeightIn").val()!=""&&!a.test($("#grossWeightIn").val())){$("#grossWeightIn").siblings("p").html("毛重最多八位整数俩位小数");return false}else{$("#grossWeightIn").siblings("p").html("")}if($("#tareWeightIn").val()!=null&&$("#tareWeightIn").val()!=""&&!a.test($("#tareWeightIn").val())){$("#tareWeightIn").siblings("p").html("皮重最多八位整数俩位小数");return false}else{$("#tareWeightIn").siblings("p").html("")}if($("#deduction").val()!=null&&$("#deduction").val()!=""&&!a.test($("#deduction").val())){$("#deduction").siblings("p").html("皮重最多八位整数俩位小数");return false}else{$("#deduction").siblings("p").html("")}if(!e.test($("#unitPrice").val())){}else{$("#unitPrice").siblings("p").html("")}if(c==1){if($("#waterxm").val()!=""&&!d.test($("#waterxm").val())){$("#waterxm").siblings("p").html("水分最多俩位整数一位小数");return false}else{$("#waterxm").siblings("p").html("")}if($("#buwanshanlixm").val()!=""&&!d.test($("#buwanshanlixm").val())){$("#buwanshanlixm").siblings("p").html("不完善粒最多俩位整数一位小数");return false}else{$("#buwanshanlixm").siblings("p").html("")}if($("#impurityxm").val()!=""&&!d.test($("#impurityxm").val())){$("#impurityxm").siblings("p").html("杂质最多俩位整数一位小数");return false}else{$("#impurityxm").siblings("p").html("")}}else{if($("#water").val()!=""&&!d.test($("#water").val())){$("#water").siblings("p").html("水分最多俩位整数一位小数");return false}else{$("#water").siblings("p").html("")}if($("#meibian").val()!=""&&!d.test($("#meibian").val())){$("#meibian").siblings("p").html("霉变最多俩位整数一位小数");return false}else{$("#meibian").siblings("p").html("")}if($("#buwanshanli").val()!=""&&!d.test($("#buwanshanli").val())){$("#buwanshanli").siblings("p").html("不完善粒最多俩位整数一位小数");return false}else{$("#buwanshanli").siblings("p").html("")}if($("#impurity").val()!=""&&!d.test($("#impurity").val())){$("#impurity").siblings("p").html("杂质最多俩位整数一位小数");return false}else{$("#impurity").siblings("p").html("")}}return true}$("#temporary").on("click",function(){if($("#temporary").hasClass("disable")){alert("不可重复提交!");return}$("#temporary").addClass("disable");var g=false;if(!checkForms()){$("#temporary").removeClass("disable");return false}var b=$("#date").val();var c={};var k=locationNum;var h=locationText;c.recordType=1;c.userId=ownerId;c.operateUserId=userId;c.depotId=$("#depot").val();c.recordNumber=$("#recordNumber").text().replace("No.","");c.date=b;c.licensePlate=$("#licensePlate").val();var d=$("#grainType").val();if(d==1){c.bulkDensity=$("#rongzhongxm").val();c.imperfectGrains=$("#buwanshanlixm").val();c.moistureContent=$("#waterxm").val();c.impurity=$("#impurityxm").val();c.productQuality=$("#qualityxm").val();c.remark=$("#remarkxm").val();if(c.productQuality!=null&&c.productQuality!=""&&c.productQuality*1>0){if(c.bulkDensity==null||c.bulkDensity==""){alert("请填写容重！");$("#temporary").removeClass("disable");return false}if(c.productQuality*1==1){if(c.bulkDensity!=null&&c.bulkDensity!=""&&c.bulkDensity*1<790){alert("质量与容重不匹配，容重必须大于等于 790！");$("#temporary").removeClass("disable");return false}}else{if(c.productQuality*1==2){if(c.bulkDensity!=null&&c.bulkDensity!=""&&c.bulkDensity*1<770||c.bulkDensity*1>790){alert("质量与容重不匹配，容重必须大于等于 770，小于790！");$("#temporary").removeClass("disable");return false}}else{if(c.productQuality*1==3){if(c.bulkDensity!=null&&c.bulkDensity!=""&&c.bulkDensity*1<750||c.bulkDensity*1>770){alert("质量与容重不匹配，容重必须大于等于 750，小于770！");$("#temporary").removeClass("disable");return false}}else{if(c.productQuality*1==4){if(c.bulkDensity!=null&&c.bulkDensity!=""&&c.bulkDensity*1<730||c.bulkDensity*1>750){alert("质量与容重不匹配，容重必须大于等于 730，小于750！");$("#temporary").removeClass("disable");return false}}else{if(c.productQuality*1==5){if(c.bulkDensity!=null&&c.bulkDensity!=""&&c.bulkDensity*1<710||c.bulkDensity*1>730){alert("质量与容重不匹配，容重必须大于等于 710，小于730！");$("#temporary").removeClass("disable");return false}}else{if(c.productQuality*1==6){if(c.bulkDensity!=null&&c.bulkDensity!=""&&c.bulkDensity*1>710){alert("质量与容重不匹配，容重必须小于 710！");$("#temporary").removeClass("disable");return false}}}}}}}}}else{c.bulkDensity=$("#rongzhong").val();c.imperfectGrains=$("#buwanshanli").val();c.moistureContent=$("#water").val();c.impurity=$("#impurity").val();c.mildew=$("#meibian").val();c.productQuality=$("#quality").val();c.remark=$("#remark").val();if(d!=3){if(c.productQuality!=null&&c.productQuality!=""&&c.productQuality*1>0){if(c.bulkDensity==null||c.bulkDensity==""){alert("请填写容重！");$("#temporary").removeClass("disable");return false}if(c.productQuality*1==1){if(c.bulkDensity!=null&&c.bulkDensity!=""&&c.bulkDensity*1<720){alert("质量与容重不匹配，容重必须大于等于 720！");$("#temporary").removeClass("disable");return false}}else{if(c.productQuality*1==2){if(c.bulkDensity!=null&&c.bulkDensity!=""&&c.bulkDensity*1<685||c.bulkDensity*1>720){alert("质量与容重不匹配，容重必须大于等于 685，小于720！");$("#temporary").removeClass("disable");return false}}else{if(c.productQuality*1==3){if(c.bulkDensity!=null&&c.bulkDensity!=""&&c.bulkDensity*1<650||c.bulkDensity*1>685){alert("质量与容重不匹配，容重必须大于等于 650，小于685！");$("#temporary").removeClass("disable");return false}}else{if(c.productQuality*1==4){if(c.bulkDensity!=null&&c.bulkDensity!=""&&c.bulkDensity*1<620||c.bulkDensity*1>650){alert("质量与容重不匹配，容重必须大于等于 620，小于650！");$("#temporary").removeClass("disable");return false}}else{if(c.productQuality*1==5){if(c.bulkDensity!=null&&c.bulkDensity!=""&&c.bulkDensity*1<590||c.bulkDensity*1>620){alert("质量与容重不匹配，容重必须大于等于 590，小于620！");$("#temporary").removeClass("disable");return false}}else{if(c.productQuality*1==6){if(c.bulkDensity!=null&&c.bulkDensity!=""&&c.bulkDensity*1>590){alert("质量与容重不匹配，容重必须小于 590！");$("#temporary").removeClass("disable");return false}}}}}}}}}}c.grainType=d;c.grossWeightIn=$("#grossWeightIn").val();c.netWeightIn=$("#netWeightIn").val();c.tareWeightIn=$("#tareWeightIn").val();c.unitPrice=$("#unitPrice").val();c.moneyIn=$("#moneyIn").val();c.paidMoney=$("#paidMoney").val();c.deduction=$("#deduction").val();c.varietyType=$("#varietyType").val();c.packingType=$("#packingType").val();c.productionNiafe=$("#productionNiafe").val();c.smell=$("#smell").val();if(k==undefined){k=""}if(h==undefined){h=""}c.location=k;c.locationDesc=h;if(driverstate){c.driverId=-100;c.driverName=$("#addDriver").val();c.driverPhone=$("#driverPhone").val();if(c.driverPhone!=null&&c.driverPhone!=""){var a={};a.userId=userId;a.staffType=3;a.phone=$("#driverPhone").val();g=Restful.post("bsinventorystaff/isExist",a)}}else{var f=$("#driver").val();if(f!=0){c.driverId=f;c.driverName=$("#driver").find("option:selected").text();var j=$("#driver").children("option:selected").index();c.driverPhone=driverPhone[j]}else{c.driverId="";c.driverName="";c.driverPhone=""}}if(!g){}else{alert("司机手机号已存在！");$("#temporary").removeClass("disable");return false}if(isNewPerson){c.staffId=-100;c.staffName=$("#addPerson").val();c.staffPhone=$("#phone").val();if(c.staffPhone!=null&&c.staffPhone!=""){var a={};a.userId=userId;a.staffType=1;a.phone=$("#phone").val();g=Restful.post("bsinventorystaff/isExist",a)}}else{var e=$("#salePerson").val();if(e!=0){c.staffId=e;c.staffName=$("#salePerson").find("option:selected").text();var j=$("#salePerson").children("option:selected").index();c.staffPhone=phoneArray[j]}else{c.staffId="";c.staffName="";c.staffPhone=""}}if(!g){var i=Restful.post("bsInventoryTemporary/insert",c);if(i.success){alert("暂存成功");window.location.href="noInForm.html";localStorage.setItem("hrefType","noInForm")}else{alert("提交失败，稍后再试");$("#temporary").removeClass("disable")}}else{alert("送粮人手机号已存在");$("#temporary").removeClass("disable")}});$(document).on("blur",'.form-article input:not([id="date"])',function(){if($(this).val()){$(this).nextAll("p").html("")}});$(".add-person").click(function(){$(".addPerson").show();$(".form-modal input").val("")});$(".addPersonbtn").click(function(){var d=$(this).parents(".modal-container").find(".addname").val();var b=$(this).parents(".modal-container").find(".addphone").val();if(!d){alert("请输入姓名");return}if(!b){alert("请输入电话");return}$("#addPerson").val(d);$("#phone").val(b);var f={};f.userId=ownerId;f.staffType=1;f.trueName=d;f.phone=b;f.idCard="";f.cardNumber="";f.company="";f.remark="";var a=Restful.post("bsinventorystaff",f);if(a&&a.success){var c=Restful.post("bsinventorystaff/list",{userId:ownerId,staffType:1,pageSize:1000});if(c&&c.success){var e=c.dataList;select2Array=[];select2Array.push({id:0,text:"请选择",phone:""});$.each(e,function(g,h){select2Array.push({id:h.staffId,text:h.trueName,phone:h.phone});phoneArray.push(h.phone)})}else{alert("添加失败，稍后再试")}$("#salePerson").select2({data:select2Array,templateResult:formatState});$("#salePerson").val($("#salePerson option:last-child").val()).select2({data:select2Array,templateResult:formatState})}else{alert("添加失败，稍后再试")}$(".addPerson").hide()});$(".addPersoncencel").click(function(){$(".form-modal").hide()});$(".add-driver").click(function(){$(".addDriver").show();$(".form-modal input").val("")});$(".addDriverbtn").click(function(){var d=$(this).parents(".modal-container").find(".addname").val();var c=$(this).parents(".modal-container").find(".addphone").val();if(!d){alert("请输入姓名");return}if(!c){alert("请输入电话");return}$("#addDriver").val(d);$("#driverPhone").val(c);var f={};f.userId=ownerId;f.staffType=3;f.trueName=d;f.phone=c;f.idCard="";f.cardNumber="";f.company="";f.remark="";var b=Restful.post("bsinventorystaff",f);if(b&&b.success){var e=Restful.post("bsinventorystaff/list",{userId:ownerId,staffType:3,pageSize:1000});if(e&&e.success){var a=e.dataList;driverArray.push({id:0,text:"请选择",phone:""});$.each(a,function(g,h){driverArray.push({id:h.staffId,text:h.trueName,phone:h.phone});licensePlate.push(h.licensePlate);driverPhone.push(h.phone)})}else{alert("添加失败，稍后再试")}$("#driver").select2({data:driverArray,templateResult:formatState});$("#driver").val($("#driver option:last-child").val()).select2({data:driverArray,templateResult:formatState})}else{alert("添加失败，稍后再试")}$(".addDriver").hide()});$(".addDrivercencel").click(function(){$(".form-modal").hide()});function numberCtrl(b,c){var d=$(b).val();var e=d.split(".");if(e.length>1){if(e[1].length>c){e[1]=e[1].substring(0,c)}$(b).val(e[0]+"."+e[1])}}var str=$("#paidMoney").val();$("#paidMoney").blur(function(){var a=$("#paidMoney").val();if(a.substr(0,1)==0||a.substr(0,1)=="-"){a=a.replace(/^[0,-]*/g,"");$("#paidMoney").val(a)}});