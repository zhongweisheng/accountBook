$(".leftContent > div:nth-child(6)> p:nth-child(6)").addClass("left_active");$(".leftContent > div:nth-child(5)").addClass("left_active");$(".child").eq(2).css("display","block");var paidMoney,unpaidMoney,startDate="",endDate="";var grainType=1;var searchType=1;var currentPage=1;var pages;var depot="0";var name="";var searchStaffId="";var userId=DES3.decrypt(localStorage.getItem("userId"));var ownerId=DES3.decrypt(localStorage.getItem("ownerId"));var userName=DES3.decrypt(localStorage.getItem("userName"));getData();initPaging();var select2Array=[];var person=Restful.post("bsinventorystaff/list",{userId:ownerId,staffType:1,pageSize:1000});if(person){if(person.success){var personArr=person.dataList;select2Array.push({id:0,text:"请选择",phone:""});$.each(personArr,function(a,b){select2Array.push({id:b.staffId,text:b.trueName,phone:b.phone})})}else{select2Array.push({id:0,text:"无",phone:""})}}$("#dateStart").datetimepicker({startView:4,minView:2,todayBtn:true,todayHighlight:true,language:"zh-CN"});$("#dateEnd").datetimepicker({startView:4,minView:2,todayBtn:true,todayHighlight:true,language:"zh-CN"}).on("change",function(){startDate=$("#dateStart").val();endDate=$("#dateEnd").val();getData();if(searchType!=1){deleteTd();changePerson()}else{$(".rightContent td").css("display","table-cell")}});function clearDate(){location.reload();$("#dateStart,#dateEnd").val("");if(searchType!=1){deleteTd();changePerson()}else{$(".rightContent td").css("display","table-cell")}}$("#salePerson").select2({data:select2Array,templateResult:formatState});function deleteTd(){$(".rightContent thead > tr > td:nth-child(8)").css("display","none");$(".rightContent tbody > tr > td:nth-child(8)").css("display","none");$(".rightContent thead > tr > td:nth-child(11)").css("display","none");$(".rightContent tbody > tr > td:nth-child(11)").css("display","none")}$("#excelBtn").on("click",function(){if(confirm("导出表格?")){rptDownLoad()}});function changePerson(){var a=$("#salePerson").find("option:selected").text();if(a!="请选择"){$(".staffName").html(a)}else{$(".staffName").html("全部")}}$("#timeChange").on("click","a",function(){if($(this).attr("id")=="excelBtn"){return}searchType=$(this).attr("data-timeType");currentPage=1;getData();if(searchType!=1){deleteTd();changePerson()}else{$(".rightContent td").css("display","table-cell")}$(this).removeClass("watch").addClass("watchActive");$(this).parent().siblings().find("a").removeClass("watchActive").addClass("watch")});function formatState(b){if(!b.id){return b.text}var a="";if(b.text!="请选择"){a=$('<span style="display: inline-block;height: 2rem;">姓名: '+b.text+"</br><span>手机号:"+b.phone+"</span></span>")}else{a=$('<span style="display: inline-block;">'+b.text+"</span>")}return a}$("#timeChange").on("click","a",function(){if($(this).attr("id")=="excelBtn"){return}searchType=$(this).attr("data-timeType");currentPage=1;getData();if(searchType!=1){deleteTd();changePerson()}else{$(".rightContent td").css("display","table-cell")}$(this).removeClass("watch").addClass("watchActive");$(this).parent().siblings().find("a").removeClass("watchActive").addClass("watch")});$("#salePerson").on("change",function(){searchStaffId=$("#salePerson").val();currentPage=1;getData();if(searchType!=1){deleteTd();changePerson()}else{$(".rightContent td").css("display","table-cell")}});var depotre=Restful.post("bsinventorydepot/getDepots",{userId:userId});if(depotre){var html='<option value="0">全部</option>';for(var i=0,len=depotre.length;i<len;i++){html+=' <option value="'+depotre[i].id+'" >'+depotre[i].name+"</option>"}$(".depot").html("").append(html)}$("#depot").on("change",function(){depot=$("#depot").val();currentPage=1;getData()});$(".page").on("click",function(a){currentPage=$(".activP").text();getData(1)});$("#grainType").on("change",function(){grainType=$("#grainType").val();currentPage=1;getData();if(searchType!=1){deleteTd();changePerson()}else{$(".rightContent td").css("display","table-cell")}});function getData(a){var c={};c.grainType=grainType;c.currentPage=currentPage;c.searchType=searchType;c.ownerId=ownerId;c.userId=userId;c.depotId=depot;c.recordType=3;c.pageSize=10;c.staffName=name;c.staffId=searchStaffId;c.startDate=startDate;c.endDate=endDate;var h=Restful.post("bsinventorystorage/search",c);if(h.success){var d=h.dataList;for(var e=0,g=d.length;e<g;e++){if(d[e].paidMoney==""){d[e].paidMoney=0}if(searchType==1&&d[e].paidMoney!=""){d[e].paidMoney=d[e].paidMoney.split(",").join("")}if(d[e].unpaidMoney==""){d[e].unpaidMoney=d[e].money}}var b=$("#inTable-list").html();var j=Template7.compile(b);var f=j({inTable:d});$("#list").html(f);pages=Math.ceil(h.total/10);if(a==1){}else{initPaging()}}else{pages=1;initPaging();$("#list").html("");$("#list").html('<tr><td colspan="12"><div style="width: 100%;height: 400px;line-height: 400px;font-size: 30px;text-align: center;margin:0 auto;color: #c1c1c1;text-shadow: #999999;">暂无数据</div>')}}function initPaging(){$(".page").page({leng:pages,activeClass:"activP"});$(".page").on("click",function(){currentPage=$(".activP").text();getData(1);if(searchType!=1){deleteTd();changePerson()}else{$(".rightContent td").css("display","table-cell")}})}function toEdit(a){var b=$(a).attr("data-id");location.href="editStorage.html?id="+b}function showEdit(){if(searchType!=1){deleteTd()}else{$(".rightContent td").css("display","table-cell")}if(currentPage==1){$(".edit").css("display","inline-block")}}function fmoney(b,d){d=d>0&&d<=20?d:2;b=parseFloat((b+"").replace(/[^\d\.-]/g,"")).toFixed(d)+"";var a=b.split(".")[0].split("").reverse(),c=b.split(".")[1];t="";for(i=0;i<a.length;i++){t+=a[i]+((i+1)%3==0&&(i+1)!=a.length?",":"")}return t.split("").reverse().join("")+"."+c}var thatId,hasSettled,notSettled;$("#list").on("click",".balance",function(){thatId=$(this).attr("data-id");$(".balanceModel input").val("");var b=$(this).parent().parent().children("td");$(".b-staffName").html(b.eq(2).html()?b.eq(2).html():"无");$(".b-date").html(b.eq(1).html());$(".b-netWeight").html(b.eq(6).html());hasSettled=parseFloat(b.eq(7).html().split(",").join(""));$(".b-hasSettled").html(hasSettled);var d=parseFloat(b.eq(3).html().split(",").join(""));var a=parseFloat(b.eq(4).html().split(",").join(""));var c=parseFloat(b.eq(5).html().split(",").join(""));$(".balanceModel").animate({left:"0"},500);$(".b-yes").animate({left:"150%"},500);notSettled=d-a-c-hasSettled;if(notSettled==0){notSettled="0"}conuntWeight=parseFloat(b.eq(6).html().split(",").join(""));$(".b-notSettled").html(notSettled);$(".balanceModel").animate({left:"0"},500)});var testNum=true;function calcu(){var b=parseFloat($("#settleCount").val());var a=parseFloat($("#settlePrice").val());var c=b*a*2;$("#shouldPay").html(c?c.toFixed(2):0);$(".b-hasSettled").html(hasSettled+b);$(".b-notSettled").html(conuntWeight-(hasSettled+b));$(".settleCount").html(b);$(".settlePrice").html(a);$("#actualPay").val(c?c.toFixed(2):0);$(".actualPay").html(c?c.toFixed(2):0)}$("#settleCount,#settlePrice").keyup(function(){calcu()});$("#actualPay").keyup(function(){$(".actualPay").html($(this).val())});$("#b-cencel").on("click",function(){$(".balanceModel").animate({left:"100%"},500)});$("#b-confirm").on("click",function(){if($("#settleCount").val()==""||$("#settlePrice").val()==""||$("#actualPay").val()==""){alert("请填写完整数据")}else{if($(".b-notSettled").html()<0){alert("今日结算数大于未结算数");testNum=false}else{testNum=true}if(testNum){$(".b-write").animate({left:"-50%"},500);$(".b-yes").animate({left:"50%"},500)}}});$("#b-back").on("click",function(){$(".b-write").animate({left:"50%"},500);$(".b-yes").animate({left:"150%"},500)});$("#b-submit").on("click",function(){var b=parseFloat($("#settleCount").val());var c={};c.operateUserName=userName;c.operateUserId=userId;c.storageId=thatId;c.settleCount=$("#settleCount").val();c.settlePrice=$("#settlePrice").val();c.shouldPay=$("#shouldPay").html();c.actualPay=$("#actualPay").val();c.hasSettled=$(".b-hasSettled").html();c.notSettled=$(".b-notSettled").html();if(testNum){var a=Restful.post("bsinventorystoragepay",c);if(a&&a.success){alert("结算成功");$(".balanceModel").animate({left:"100%"},500);$(".b-write").animate({left:"50%"},500);getData()}else{alert("结算不成功");$(".balanceModel").animate({left:"100%"},500)}}});$("#list").on("click",".print",function(){var a=$(this).attr("data-id");window.open("dataPrintStorage.html?id="+a)});$("#list").on("click",".details",function(){var a=$(this).attr("data-id");window.location.href="storageDetails.html?id="+a});$("#list").on("click",".delete",function(){var d=$(this).attr("data-id");var b=confirm("是否删除本条数据?");if(b){var c={};c.recordId=d;var a=Restful.post("bsinventorystorage/deleteRecordOrdre",c);if(a.success){getData()}}});function rptDownLoad(){var c=$("<form>");c.attr("style","display:none");c.attr("target","");c.attr("method","post");c.attr("action","/accountBook/bsinventorystorage/export");var b=$("<input>");b.attr("type","hidden");b.attr("name","grainType");b.attr("value",grainType);var a=$("<input>");a.attr("type","hidden");a.attr("name","searchType");a.attr("value",1);var g=$("<input>");g.attr("type","hidden");g.attr("name","userId");g.attr("value",ownerId);var f=$("<input>");f.attr("type","hidden");f.attr("name","recordType");f.attr("value",3);var e=$("<input>");e.attr("type","hidden");e.attr("name","startDate");e.attr("value",startDate);var d=$("<input>");d.attr("type","hidden");d.attr("name","endDate");d.attr("value",endDate);$("body").append(c);c.append(b);c.append(a);c.append(g);c.append(f);c.append(e);c.append(d);c.submit();c.remove()}function excelBtn(){if(confirm("导出表格?")){rptDownLoad()}};